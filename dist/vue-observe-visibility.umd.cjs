(function(o,c){typeof exports=="object"&&typeof module<"u"?c(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],c):(o=typeof globalThis<"u"?globalThis:o||self,c(o.VueObserveVisibility={},o.vue))})(this,function(o,c){"use strict";function O(t){let i;return typeof t=="function"?i={callback:t}:i=t,i}function g(t,i,n={}){let e,s,r;const f=(l,...m)=>{if(r=m,e&&l===s)return;let h=n.leading;typeof h=="function"&&(h=h(l,s)),(!e||l!==s)&&h&&t(l,...r),s=l,clearTimeout(e),e=setTimeout(()=>{t(l,...r),e=0},i)};return f._clear=()=>{clearTimeout(e),e=null},f}function b(t,i){if(t===i)return!0;if(typeof t=="object"){for(const n in t)if(!b(t[n],i[n]))return!1;return!0}return!1}class k{constructor(i,n,e){this.el=i,this.observer=null,this.frozen=!1,this.createObserver(n,e)}get threshold(){return this.options.intersection&&typeof this.options.intersection.threshold=="number"?this.options.intersection.threshold:0}createObserver(i,n){if(this.observer&&this.destroyObserver(),!this.frozen){if(this.options=O(i),this.callback=(e,s)=>{this.options.callback(e,s),e&&this.options.once&&(this.frozen=!0,this.destroyObserver())},this.callback&&this.options.throttle){const{leading:e}=this.options.throttleOptions||{};this.callback=g(this.callback,this.options.throttle,{leading:s=>e==="both"||e==="visible"&&s||e==="hidden"&&!s})}this.oldResult=void 0,this.observer=new IntersectionObserver(e=>{let s=e[0];if(e.length>1){const r=e.find(f=>f.isIntersecting);r&&(s=r)}if(this.callback){const r=s.isIntersecting&&s.intersectionRatio>=this.threshold;if(r===this.oldResult)return;this.oldResult=r,this.callback(r,s)}},this.options.intersection),c.nextTick(()=>{this.observer&&this.observer.observe(this.el)})}}destroyObserver(){this.observer&&(this.observer.disconnect(),this.observer=null),this.callback&&this.callback._clear&&(this.callback._clear(),this.callback=null)}}function d(t,{value:i},n){if(i)if(typeof IntersectionObserver>"u")console.warn("[vue-observe-visibility] IntersectionObserver API is not available in your browser. Please install this polyfill: https://github.com/w3c/IntersectionObserver/tree/master/polyfill");else{const e=new k(t,i,n);t._vue_visibilityState=e}}function _(t,{value:i,oldValue:n},e){if(b(i,n))return;const s=t._vue_visibilityState;if(!i){a(t);return}s?s.createObserver(i,e):d(t,{value:i},e)}function a(t){const i=t._vue_visibilityState;i&&(i.destroyObserver(),delete t._vue_visibilityState)}const v={created:d,updated:_,beforeUnmount:a};function p(t){t.directive("observe-visibility",v)}const y={install:p};let u=null;typeof window<"u"?u=window.Vue:typeof global<"u"&&(u=global.Vue),u&&u.use(y),o.ObserveVisibility=v,o.default=y,o.install=p,Object.defineProperties(o,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
